<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BWDC Product Team 2026 ‚Äî Interactive Roadmap</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,600;0,700;1,600&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --cream:#F2EDE3;--cream-dark:#E8E1D3;--forest:#1E2E23;--forest-mid:#2D3B2D;
  --forest-light:#3D5240;--teal:#4A9B8E;--teal-light:#7EC8BE;--teal-pale:#D4EDEA;
  --gold:#C8903A;--gold-pale:#F5E6CC;--rose:#C97B6A;--rose-pale:#F5DDD8;
  --sage:#7A9E7E;--sage-pale:#DFF0E0;--white:#fff;--text:#3A3A2E;--muted:#7A7A6A;--border:#D8D0C0;
  --critical:#E8453C;--critical-pale:#FDECEA;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--text);font-size:13px;overflow-x:hidden;}

/* HEADER */
.header{background:var(--forest);color:var(--cream);padding:16px 28px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,0.3);}
.header h1{font-family:'Playfair Display',serif;font-size:20px;font-weight:700;}
.header h1 em{font-style:italic;color:var(--teal-light);}
.header-sub{font-size:10px;color:rgba(242,237,227,0.5);letter-spacing:1.5px;text-transform:uppercase;margin-top:2px;}
.legend{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.legend-item{display:flex;align-items:center;gap:4px;font-size:11px;color:rgba(242,237,227,0.7);}
.legend-dot{width:10px;height:10px;border-radius:2px;}
.legend-diamond{width:10px;height:10px;background:#F5C842;transform:rotate(45deg);border:1.5px solid white;box-shadow:0 1px 4px rgba(0,0,0,0.2);}
.legend-critical{width:10px;height:10px;border-radius:2px;background:var(--critical);}

/* TOOLBAR */
.toolbar{background:var(--forest-mid);padding:8px 28px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;border-bottom:2px solid var(--gold);}
.filter-label{font-size:10px;color:rgba(242,237,227,0.5);letter-spacing:1.5px;text-transform:uppercase;}
.filter-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);color:rgba(242,237,227,0.8);padding:4px 12px;border-radius:20px;cursor:pointer;font-size:11px;font-family:'DM Sans',sans-serif;transition:all 0.2s;}
.filter-btn:hover,.filter-btn.active{background:var(--teal);border-color:var(--teal);color:white;}
.toolbar-sep{width:1px;height:20px;background:rgba(255,255,255,0.1);}
.view-btn{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);color:rgba(242,237,227,0.8);padding:4px 12px;border-radius:6px;cursor:pointer;font-size:11px;font-family:'DM Sans',sans-serif;transition:all 0.2s;}
.view-btn:hover,.view-btn.active{background:var(--gold);border-color:var(--gold);color:white;}
.critical-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;font-size:11px;color:rgba(242,237,227,0.7);padding:4px 10px;border-radius:20px;border:1px solid rgba(255,255,255,0.15);transition:all 0.2s;}
.critical-toggle:hover,.critical-toggle.active{background:var(--critical-pale);color:var(--critical);border-color:var(--critical);}
.critical-toggle input{accent-color:var(--critical);cursor:pointer;}
.progress-summary{margin-left:auto;display:flex;align-items:center;gap:8px;font-size:11px;color:rgba(242,237,227,0.7);}
.overall-bar{width:100px;height:5px;background:rgba(255,255,255,0.1);border-radius:3px;overflow:hidden;}
.overall-fill{height:100%;background:var(--teal-light);border-radius:3px;transition:width 0.5s;}

/* VIEWS */
.view-gantt{display:flex;}
.view-workload{display:none;padding:28px;}
.view-gantt.hidden,.view-workload.hidden{display:none!important;}
.view-workload.active{display:block!important;}
.view-gantt.active{display:flex!important;}

/* GANTT */
.gantt-sidebar{width:300px;min-width:300px;background:var(--white);border-right:1px solid var(--border);position:sticky;left:0;z-index:10;flex-shrink:0;}
.gantt-body{flex:1;overflow-x:auto;position:relative;min-width:0;}
.sidebar-header{background:var(--cream-dark);padding:12px 16px;border-bottom:1px solid var(--border);font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);height:52px;display:flex;align-items:center;}
.months-header{display:flex;height:52px;border-bottom:1px solid var(--border);background:var(--cream-dark);position:sticky;top:0;z-index:5;}
.month-cell{flex:1;min-width:80px;border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--muted);}
.month-cell.current{background:var(--teal-pale);color:var(--teal);}

/* GROUP */
.group-row{background:var(--forest);color:var(--cream);padding:7px 14px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;display:flex;align-items:center;gap:8px;cursor:pointer;user-select:none;border-bottom:1px solid rgba(255,255,255,0.05);}
.group-row:hover{background:var(--forest-mid);}
.group-chevron{transition:transform 0.2s;font-size:9px;}
.group-row.collapsed .group-chevron{transform:rotate(-90deg);}
.group-bar-row{background:rgba(0,0,0,0.02);height:32px;display:flex;align-items:center;border-bottom:1px solid var(--border);}

/* INITIATIVE ROW */
.init-row{border-bottom:1px solid var(--border);transition:background 0.15s;}
.init-row:hover .init-sidebar{background:#faf9f5;}
.init-row.hidden{display:none!important;}
.init-sidebar{padding:8px 14px;display:flex;flex-direction:column;gap:3px;min-height:64px;justify-content:center;cursor:pointer;transition:background 0.15s;}
.init-name{font-family:'Playfair Display',serif;font-size:12px;font-weight:600;color:var(--forest);line-height:1.3;}
.init-lead{font-size:10px;color:var(--muted);}
.progress-wrap{display:flex;align-items:center;gap:5px;margin-top:2px;}
.progress-track{flex:1;height:4px;background:var(--cream-dark);border-radius:2px;overflow:hidden;position:relative;}
.progress-fill{height:100%;border-radius:2px;transition:width 0.4s ease;position:relative;z-index:1;}
.progress-pct{font-size:10px;font-weight:700;color:var(--muted);min-width:26px;text-align:right;}
.assignees{display:flex;gap:3px;flex-wrap:wrap;margin-top:2px;}
.assignee-chip{display:inline-flex;align-items:center;gap:2px;background:var(--teal-pale);color:var(--teal);font-size:10px;font-weight:600;padding:2px 7px;border-radius:10px;}
.assignee-chip.add-btn{background:var(--cream-dark);color:var(--muted);border:1px dashed var(--border);cursor:pointer;}
.assignee-chip.add-btn:hover{background:var(--gold-pale);color:var(--gold);border-color:var(--gold);}

/* CRITICAL PATH */
.init-row.critical .init-sidebar{border-left:3px solid var(--critical)!important;}
.init-row.critical .init-name{color:var(--critical);}
.gantt-bar.critical-bar{box-shadow:0 0 0 2px var(--critical),0 2px 8px rgba(232,69,60,0.3)!important;filter:none!important;}
.gantt-bar.critical-bar::before{content:'';position:absolute;inset:0;border-radius:6px;background:repeating-linear-gradient(45deg,rgba(255,255,255,0.1) 0,rgba(255,255,255,0.1) 3px,transparent 3px,transparent 8px);}

/* EXPANDED ACTIVITIES DROPDOWN */
.activities-dropdown{background:var(--cream);border-top:1px solid var(--border);overflow:hidden;max-height:0;transition:max-height 0.35s ease;}
.activities-dropdown.open{max-height:600px;}
.act-dropdown-inner{padding:10px 14px;}
.act-section-title{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--teal);margin-bottom:8px;}
.act-item{display:flex;align-items:flex-start;gap:8px;padding:7px 10px;border-radius:8px;margin-bottom:5px;background:var(--white);border:1px solid var(--border);transition:all 0.15s;}
.act-item.done{background:var(--teal-pale);border-color:var(--teal-pale);}
.act-item.done .act-text{text-decoration:line-through;color:var(--muted);}
.act-item.deprioritized{background:#f7f7f5;border:1px dashed var(--border);opacity:0.62;}
.act-item.deprioritized .act-text{color:var(--muted);font-style:italic;}
.act-check{width:15px;height:15px;min-width:15px;border-radius:4px;border:2px solid var(--border);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;background:white;margin-top:1px;}
.act-check.checked{background:var(--teal);border-color:var(--teal);}
.act-check.checked::after{content:'‚úì';color:white;font-size:9px;font-weight:700;}
.act-text{font-size:12px;line-height:1.4;flex:1;}
.act-actions{display:flex;align-items:center;gap:4px;flex-shrink:0;margin-top:1px;}
.act-badge{font-size:9px;font-weight:700;padding:2px 6px;border-radius:8px;white-space:nowrap;}
.act-badge.ms{background:var(--gold-pale);color:var(--gold);}
.act-badge.dep{background:var(--rose-pale);color:var(--rose);}
.act-depr-btn{background:none;border:1px solid var(--border);border-radius:6px;padding:2px 6px;font-size:9px;font-weight:700;cursor:pointer;color:var(--muted);font-family:'DM Sans',sans-serif;transition:all 0.2s;white-space:nowrap;line-height:1.4;}
.act-depr-btn:hover{background:var(--rose-pale);color:var(--rose);border-color:var(--rose);}
.act-depr-btn.reprioritize{background:var(--sage-pale);color:var(--sage);border-color:var(--sage);}
.act-depr-btn.reprioritize:hover{background:var(--teal-pale);color:var(--teal);border-color:var(--teal);}

/* ASSIGNEE EDITOR in dropdown */
.assignee-editor-row{display:flex;align-items:center;gap:6px;margin-top:8px;padding-top:8px;border-top:1px solid var(--border);flex-wrap:wrap;}
.assignee-tag{display:inline-flex;align-items:center;gap:3px;background:var(--teal-pale);color:var(--teal);padding:3px 9px;border-radius:14px;font-size:11px;font-weight:600;}
.assignee-tag .rm{cursor:pointer;color:var(--muted);font-size:13px;line-height:1;transition:color 0.15s;margin-left:1px;}
.assignee-tag .rm:hover{color:var(--rose);}
.add-input{border:1px solid var(--border);border-radius:8px;padding:4px 10px;font-family:'DM Sans',sans-serif;font-size:11px;background:var(--white);color:var(--text);outline:none;width:120px;transition:border-color 0.2s;}
.add-input:focus{border-color:var(--teal);}
.add-btn-sm{background:var(--teal);color:white;border:none;border-radius:8px;padding:4px 10px;font-size:11px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;}

/* COMMENTS */
.comments-section{margin-top:8px;padding-top:8px;border-top:1px solid var(--border);}
.comment-item{background:var(--white);border:1px solid var(--border);border-radius:8px;padding:8px 10px;margin-bottom:6px;}
.comment-meta{font-size:10px;color:var(--muted);margin-bottom:3px;display:flex;justify-content:space-between;}
.comment-author{font-weight:700;color:var(--forest);}
.comment-text{font-size:12px;line-height:1.55;word-break:break-word;}
.comment-text a{color:var(--teal);text-decoration:underline;word-break:break-all;}
.comment-text a:hover{color:var(--forest);}
.comment-input-row{display:flex;gap:6px;margin-top:6px;align-items:flex-start;}
.comment-input-wrap{flex:1;position:relative;}
.comment-input{width:100%;border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-family:'DM Sans',sans-serif;font-size:11px;background:var(--white);color:var(--text);outline:none;resize:none;transition:border-color 0.2s;min-height:36px;max-height:120px;overflow-y:auto;line-height:1.5;}
.comment-input:focus{border-color:var(--teal);}
.comment-char{position:absolute;bottom:5px;right:8px;font-size:9px;color:var(--muted);pointer-events:none;transition:color 0.2s;}
.comment-char.warn{color:var(--gold);}
.comment-char.over{color:var(--critical);}
.comment-author-input{border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-family:'DM Sans',sans-serif;font-size:11px;background:var(--white);color:var(--text);outline:none;width:86px;flex-shrink:0;}
.comment-submit{background:var(--forest);color:var(--cream);border:none;border-radius:8px;padding:6px 12px;font-size:11px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;white-space:nowrap;flex-shrink:0;}
.comment-submit:hover{background:var(--teal);}
.comment-submit:disabled{opacity:0.4;cursor:not-allowed;}

/* BAR AREA */
.bar-row{display:flex;align-items:center;position:relative;min-height:64px;border-bottom:1px solid var(--border);overflow:hidden;}
.bar-row.expanded{min-height:64px;}
.bar-grid{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;pointer-events:none;}
.bar-grid-col{flex:1;min-width:80px;border-right:1px solid rgba(0,0,0,0.04);}
.bar-grid-col.today-col{background:rgba(74,155,142,0.06);}
.gantt-bar{position:absolute;height:26px;border-radius:6px;display:flex;align-items:center;padding:0 10px;font-size:11px;font-weight:600;color:white;cursor:grab;transition:filter 0.2s,box-shadow 0.2s;white-space:nowrap;overflow:hidden;z-index:2;box-shadow:0 2px 6px rgba(0,0,0,0.12);user-select:none;}
.gantt-bar:hover{filter:brightness(1.08);box-shadow:0 4px 14px rgba(0,0,0,0.18);}
.gantt-bar.dragging{cursor:grabbing;opacity:0.85;box-shadow:0 8px 24px rgba(0,0,0,0.25);z-index:20;}
/* Progress overlay on bar */
.bar-progress-overlay{position:absolute;left:0;top:0;height:100%;border-radius:6px;background:rgba(0,0,0,0.15);pointer-events:none;transition:width 0.4s;}
/* Resize handles */
.resize-handle{position:absolute;width:8px;height:100%;top:0;cursor:ew-resize;z-index:5;}
.resize-handle.left{left:0;border-radius:6px 0 0 6px;}
.resize-handle.right{right:0;border-radius:0 6px 6px 0;}
.resize-handle:hover{background:rgba(255,255,255,0.2);}
/* Milestone diamond */
.milestone-diamond{position:absolute;width:16px;height:16px;transform:rotate(45deg);border-radius:2px;z-index:10;cursor:grab;transition:transform 0.2s,box-shadow 0.2s;pointer-events:all;background:#F5C842!important;border:2px solid white;box-shadow:0 2px 6px rgba(0,0,0,0.35);}
.milestone-diamond:hover{transform:rotate(45deg) scale(1.35);box-shadow:0 4px 12px rgba(0,0,0,0.4);}
/* Milestone tooltip */
.milestone-diamond .ms-tooltip{position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%) rotate(-45deg);background:var(--forest);color:var(--cream);font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;white-space:nowrap;padding:5px 10px;border-radius:6px;pointer-events:none;opacity:0;transition:opacity 0.18s;box-shadow:0 4px 12px rgba(0,0,0,0.25);z-index:50;}
.milestone-diamond .ms-tooltip::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:var(--forest);}
.milestone-diamond:hover .ms-tooltip{opacity:1;}
/* Today line */
.today-line{position:absolute;top:0;bottom:0;width:2px;background:var(--teal);z-index:4;pointer-events:none;}
.today-label{position:absolute;top:4px;background:var(--teal);color:white;font-size:9px;font-weight:700;padding:2px 5px;border-radius:3px;transform:translateX(-50%);white-space:nowrap;}
/* Dep SVG */
.dep-svg{position:absolute;top:0;left:0;pointer-events:none;z-index:1;overflow:visible;}
.dep-arrow{stroke:var(--rose);stroke-width:1.5;fill:none;stroke-dasharray:4 3;opacity:0.5;}
.dep-arrow.critical-dep{stroke:var(--critical);opacity:0.8;stroke-dasharray:none;stroke-width:2;}
.dep-head{fill:var(--rose);opacity:0.5;}
.dep-head.critical-dep{fill:var(--critical);opacity:0.8;}

/* WORKLOAD VIEW */
.wl-title{font-family:'Playfair Display',serif;font-size:24px;font-weight:700;color:var(--forest);margin-bottom:6px;}
.wl-sub{font-size:13px;color:var(--muted);margin-bottom:28px;}
.wl-person{background:var(--white);border:1px solid var(--border);border-radius:12px;padding:18px 22px;margin-bottom:16px;}
.wl-person-header{display:flex;align-items:center;gap:12px;margin-bottom:14px;}
.wl-avatar{width:36px;height:36px;border-radius:50%;background:var(--teal);color:white;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0;}
.wl-name{font-family:'Playfair Display',serif;font-size:15px;font-weight:600;color:var(--forest);}
.wl-count{font-size:11px;color:var(--muted);margin-top:1px;}
.wl-months{display:grid;grid-template-columns:repeat(12,1fr);gap:4px;}
.wl-month-col{text-align:center;}
.wl-month-label{font-size:9px;font-weight:700;text-transform:uppercase;color:var(--muted);margin-bottom:4px;letter-spacing:0.5px;}
.wl-month-bar{border-radius:4px;min-height:6px;transition:height 0.3s;}
.wl-month-num{font-size:10px;font-weight:700;margin-top:3px;}
.wl-initiative-tag{display:inline-block;font-size:10px;font-weight:600;padding:2px 8px;border-radius:10px;margin:2px;color:white;}

/* SCROLLBAR */
.gantt-body::-webkit-scrollbar{height:5px;}
.gantt-body::-webkit-scrollbar-track{background:var(--cream-dark);}
.gantt-body::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px;}
</style>
</head>
<body>

<div class="header">
  <div>
    <h1>BWDC Product Team <em>2026</em> Roadmap</h1>
    <div class="header-sub">Interactive Gantt ¬∑ Click row to expand ¬∑ Drag bars to reschedule</div>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--teal)"></div>Product-Led</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--gold)"></div>Cross-Functional</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--sage)"></div>Supporting</div>
    <div class="legend-item"><div class="legend-diamond"></div>Milestone</div>
    <div class="legend-item"><div class="legend-critical"></div>Critical Path</div>
  </div>
</div>

<div class="toolbar">
  <span class="filter-label">Filter:</span>
  <button class="filter-btn active" onclick="filterTeam('all',this)">All</button>
  <button class="filter-btn" onclick="filterTeam('product',this)">Product-Led</button>
  <button class="filter-btn" onclick="filterTeam('data',this)">+ Data</button>
  <button class="filter-btn" onclick="filterTeam('growth',this)">+ Growth</button>
  <button class="filter-btn" onclick="filterTeam('comms',this)">+ Comms</button>
  <div class="toolbar-sep"></div>
  <button class="view-btn active" onclick="switchView('gantt',this)">Gantt</button>
  <button class="view-btn" onclick="switchView('workload',this)">Workload</button>
  <div class="toolbar-sep"></div>
  <label class="critical-toggle" id="criticalToggle">
    <input type="checkbox" onchange="toggleCritical(this)"> Critical Path
  </label>
  <div class="progress-summary">
    Overall: <div class="overall-bar"><div class="overall-fill" id="overallBar" style="width:0%"></div></div>
    <span id="overallPct">0%</span>
  </div>
</div>

<div class="view-gantt active" id="viewGantt">
  <div class="gantt-sidebar" id="sidebar"></div>
  <div class="gantt-body" id="ganttBody">
    <div class="months-header" id="monthsHeader"></div>
    <div id="barsArea" style="position:relative;"></div>
  </div>
</div>

<div class="view-workload" id="viewWorkload"></div>

<script>
const MONTHS=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const MW=90,TODAY_M=1;

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const initiatives=[
  {id:'ed-launch',group:'product-led',name:'Launch Explore Data',lead:'Rich',color:'#C8903A',
   start:1,end:5,team:['product','data','growth','comms'],
   milestones:[{month:1,label:'Feb: Guided Search'},{month:2,label:'Mar: NLP Search'},{month:3,label:'Apr: Location Search'},{month:4,label:'May: Tables'}],
   deps:[],critical:true,
   activities:[
    {id:'a1',text:'Feb: Guided search + foundational UX + error states',done:false,milestone:true},
    {id:'a2',text:'Mar: NLP natural language search launch',done:false,milestone:true},
    {id:'a3',text:'Apr: Location-based search and map enhancements',done:false,milestone:true},
    {id:'a4',text:'May: Table and ranking-based results',done:false,milestone:true},
    {id:'a5',text:'Set success criteria across all teams',done:false},
    {id:'a6',text:'Define launch responsibilities and ownership',done:false},
   ],assignees:['Rich'],comments:[]},

  {id:'feature-explore',group:'product-led',name:'Feature Exploration & R&D',lead:'Rich',color:'#4A9B8E',
   start:1,end:11,team:['product'],
   milestones:[{month:5,label:'Site Search Live'},{month:8,label:'LWE Overlay'}],
   deps:['ed-launch'],critical:true,
   activities:[
    {id:'b1',text:'Overall Site Search: Add article summaries to results',done:false},
    {id:'b2',text:'LWE: Add download and overlay capability',done:false},
    {id:'b3',text:'Track CTR improvement post global search',done:false},
    {id:'b4',text:'Measure LWE overlay feature adoption',done:false},
   ],assignees:['Rich'],comments:[]},

  {id:'member-reg',group:'product-led',name:'Member Registration & Personalization',lead:'Rich',color:'#4A9B8E',
   start:0,end:5,team:['product','growth'],
   milestones:[{month:3,label:'New Onboarding Live'}],
   deps:[],critical:false,
   activities:[
    {id:'c1',text:'Add new roles and industries to user profile',done:false},
    {id:'c2',text:'Implement new user onboarding flows',done:false,milestone:true},
    {id:'c3',text:'Profile dashboard personalization',done:false},
    {id:'c4',text:'Align with Comms and Growth on revised roles list',done:false},
   ],assignees:['Rich'],comments:[]},

  {id:'arch-rebuild',group:'product-led',name:'Rebuild Architecture ‚Äî Growth Support',lead:'Rich',color:'#C97B6A',
   start:0,end:5,team:['product','growth'],
   milestones:[{month:2,label:'Phase 1 Complete'},{month:5,label:'CRM Live'}],
   deps:['member-reg'],critical:false,
   activities:[
    {id:'d1',text:'Phase 1: Webinar registration system',done:false,milestone:true},
    {id:'d2',text:'Phase 1: Redesign Contact/Inquiry system',done:false},
    {id:'d3',text:'Phase 2: Dedicated landing pages',done:false},
    {id:'d4',text:'Phase 2: CRM set-up',done:false},
   ],assignees:['Rich'],comments:[]},

  {id:'user-research',group:'product-led',name:'Establish User Research Practice',lead:'Jake/Devyn',color:'#4A9B8E',
   start:1,end:11,team:['product','growth','comms'],
   milestones:[{month:5,label:'First Workshop'},{month:11,label:'Annual Report'}],
   deps:[],critical:false,
   activities:[
    {id:'e1',text:'30-60-90 follow-up interviews for new releases',done:false},
    {id:'e2',text:'Monthly user interviews program',done:false},
    {id:'e3',text:'Quarterly User Insight Workshop',done:false,milestone:true},
    {id:'e4',text:'Annual State of User Research Report',done:false,milestone:true},
   ],assignees:['Jake','Devyn'],comments:[]},

  {id:'ai-strategy',group:'product-led',name:'Internal AI Strategy',lead:'Harsha',color:'#7A9E7E',
   start:0,end:8,team:['product','data'],
   milestones:[{month:3,label:'Advisory Board Set'},{month:11,label:'AI Pilot Live'}],
   deps:[],critical:false,
   activities:[
    {id:'f1',text:'Identify staff from every dept for AI committee',done:false},
    {id:'f2',text:'Draft AI vision/mission',done:false},
    {id:'f3',text:'Convene bi-weekly working sessions',done:false},
    {id:'f4',text:'Set up AI advisory board',done:false,milestone:true},
    {id:'f5',text:'Brief ED and board on AI pilots',done:false},
   ],assignees:['Harsha'],comments:[]},

  {id:'platform-migration',group:'product-led',name:'Platform Migration Analysis',lead:'Harsha/Rich/Julie',color:'#8A7A9E',
   start:0,end:11,team:['product','data','ops'],
   milestones:[{month:5,label:'SWOT to Leadership'},{month:11,label:'Migration Decision'}],
   deps:[],critical:true,
   activities:[
    {id:'g1',text:'Complete SWOT analysis for platform migration',done:false},
    {id:'g2',text:'Share recommendation with Tene and JHU',done:false,milestone:true},
    {id:'g3',text:'Develop JHU stakeholder engagement plan',done:false},
    {id:'g4',text:'Determine level of effort and cost',done:false},
   ],assignees:['Harsha','Rich','Julie'],comments:[]},

  {id:'feedback-nps',group:'product-led',name:'Implement NPS Feedback Loop',lead:'Rich',color:'#4A9B8E',
   start:2,end:9,team:['product','growth','comms'],
   milestones:[{month:5,label:'NPS Live'}],
   deps:['ed-launch'],critical:false,
   activities:[
    {id:'h1',text:'Determine if NPS is right approach',done:false},
    {id:'h2',text:'Implement satisfaction surveys across user flows',done:false,milestone:true},
    {id:'h3',text:'Integrate surveys into email campaigns',done:false},
   ],assignees:['Rich'],comments:[]},

  {id:'private-data',group:'supporting-data',name:'Acquire Private Data (Support)',lead:'Harsha',color:'#7A9E7E',
   start:0,end:11,team:['data','product'],
   milestones:[{month:5,label:'5 Datasets Target'}],
   deps:[],critical:false,
   activities:[
    {id:'i1',text:'Surface commercial data findings on platform',done:false},
    {id:'i2',text:'Ensure new data assets are discoverable in UX',done:false},
    {id:'i3',text:'Work with Comms to highlight insights',done:false},
   ],assignees:['Harsha'],comments:[]},

  {id:'forecasting',group:'supporting-data',name:'Data R&D ‚Äî Forecasting & Simulation',lead:'Harsha/Cara',color:'#7A9E7E',
   start:3,end:11,team:['data','product'],
   milestones:[{month:5,label:'Forecasting on Explore'}],
   deps:['ed-launch'],critical:false,
   activities:[
    {id:'j1',text:'Forecasting estimates in Explore platform',done:false,milestone:true},
    {id:'j2',text:'Identify 3-5 cities for tangled titles data',done:false},
    {id:'j3',text:'Track user engagement with R&D assets',done:false},
   ],assignees:['Harsha','Cara'],comments:[]},

  {id:'member-strategy',group:'supporting-growth',name:'Develop Member Engagement Strategy',lead:'Monique/Rich',color:'#C8903A',
   start:1,end:4,team:['product','growth','comms'],
   milestones:[{month:3,label:'Strategy Complete'}],
   deps:[],critical:false,
   activities:[
    {id:'k1',text:'Define what members get vs. non-members',done:false},
    {id:'k2',text:'Design tiered system incentivizing registration',done:false,milestone:true},
    {id:'k3',text:'Hold focus groups of current and potential users',done:false},
    {id:'k4',text:'Build out 5 core use cases',done:false},
   ],assignees:['Monique','Rich'],comments:[]},

  {id:'listening-tour',group:'supporting-growth',name:'Listening & Activation Tour',lead:'Monique',color:'#C8903A',
   start:1,end:3,team:['product','growth','comms','data','ops'],
   milestones:[{month:2,label:'Tour Launches'}],
   deps:[],critical:false,
   activities:[
    {id:'l1',text:'Pressure test wealth data activation',done:false},
    {id:'l2',text:'Engage 50%+ of existing partner list',done:false,milestone:true},
    {id:'l3',text:'Feed insights back into Explore Data roadmap',done:false},
   ],assignees:['Monique'],comments:[]},

  {id:'rapid-rename',group:'supporting-comms',name:'Rapid Rename (Brand Support)',lead:'Jermaine',color:'#C97B6A',
   start:0,end:3,team:['product','comms','data','growth','ops'],
   milestones:[{month:1,label:'Internal Rollout'},{month:3,label:'External Rollout'}],
   deps:[],critical:false,
   activities:[
    {id:'m1',text:'Internal rollout ‚Äî platform naming updated',done:false,milestone:true},
    {id:'m2',text:'External rollout ‚Äî digital properties updated',done:false,milestone:true},
    {id:'m3',text:'Alignment with SoGP announcements',done:false},
   ],assignees:['Jermaine'],comments:[]},

  {id:'brand-integration',group:'supporting-comms',name:'Brand Integration',lead:'Jermaine',color:'#C97B6A',
   start:0,end:3,team:['product','comms','data','growth','ops'],
   milestones:[{month:3,label:'Brand Live Across Platform'}],
   deps:['rapid-rename'],critical:false,
   activities:[
    {id:'n1',text:'Implement new brand voice across product surfaces',done:false},
    {id:'n2',text:'Update visual identity assets in all digital tools',done:false,milestone:true},
    {id:'n3',text:'Provide brand file to all team members',done:false},
   ],assignees:['Jermaine'],comments:[]},
];

const GROUPS=[
  {id:'product-led',label:'Product-Led Initiatives',color:'#4A9B8E'},
  {id:'supporting-data',label:'Supporting Data Team',color:'#7A9E7E'},
  {id:'supporting-growth',label:'Supporting Growth Team',color:'#C8903A'},
  {id:'supporting-comms',label:'Supporting Comms Team',color:'#C97B6A'},
];

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let collapsed={},expanded={},activeFilter='all',showCritical=false;
let dragState=null,resizeState=null;

// ‚îÄ‚îÄ LOCALSTORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveState(){
  const s={activities:{},assignees:{},comments:{},starts:{},ends:{},milestones:{}};
  initiatives.forEach(i=>{
    s.activities[i.id]=i.activities.map(a=>({done:a.done,deprioritized:!!a.deprioritized}));
    s.assignees[i.id]=[...i.assignees];
    s.comments[i.id]=[...i.comments];
    s.starts[i.id]=i.start;
    s.ends[i.id]=i.end;
    s.milestones[i.id]=(i.milestones||[]).map(m=>({...m}));
  });
  localStorage.setItem('bwdc_gantt_v2',JSON.stringify(s));
}
function loadState(){
  try{
    const s=JSON.parse(localStorage.getItem('bwdc_gantt_v2'));
    if(!s)return;
    initiatives.forEach(i=>{
      if(s.activities[i.id]) i.activities.forEach((a,idx)=>{
        a.done=s.activities[i.id][idx]?.done??a.done;
        a.deprioritized=s.activities[i.id][idx]?.deprioritized??false;
      });
      if(s.assignees[i.id]) i.assignees=s.assignees[i.id];
      if(s.comments[i.id]) i.comments=s.comments[i.id];
      if(s.starts[i.id]!==undefined) i.start=s.starts[i.id];
      if(s.ends[i.id]!==undefined) i.end=s.ends[i.id];
      if(s.milestones[i.id]) i.milestones=s.milestones[i.id];
    });
  }catch(e){}
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getPct(init){
  const active=init.activities.filter(a=>!a.deprioritized);
  if(!active.length)return 0;
  return Math.round(active.filter(a=>a.done).length/active.length*100);
}
function updateOverall(){
  const all=initiatives.flatMap(i=>i.activities);
  const pct=all.length?Math.round(all.filter(a=>a.done).length/all.length*100):0;
  document.getElementById('overallBar').style.width=pct+'%';
  document.getElementById('overallPct').textContent=pct+'%';
}
function matchesFilter(init){
  if(activeFilter==='all')return true;
  if(activeFilter==='product')return init.group==='product-led';
  return init.team.includes(activeFilter);
}
function isCriticalPath(init){
  if(!showCritical)return false;
  return init.critical;
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render(){
  renderMonths();
  renderRows();
  updateOverall();
}

function renderMonths(){
  const hdr=document.getElementById('monthsHeader');
  hdr.innerHTML=MONTHS.map((m,i)=>`<div class="month-cell ${i===TODAY_M?'current':''}">${m}</div>`).join('');
  hdr.style.minWidth=(MONTHS.length*MW)+'px';
}

function renderRows(){
  const sb=document.getElementById('sidebar');
  const ba=document.getElementById('barsArea');
  const totalW=MONTHS.length*MW;
  sb.innerHTML=`<div class="sidebar-header">Initiative</div>`;
  ba.innerHTML=`<div class="today-line" style="left:${TODAY_M*MW+15}px"><div class="today-label" style="left:0">TODAY</div></div>`;

  GROUPS.forEach(group=>{
    const gi=initiatives.filter(i=>i.group===group.id&&matchesFilter(i));
    if(!gi.length)return;
    const isColl=collapsed[group.id];

    sb.innerHTML+=`<div class="group-row ${isColl?'collapsed':''}" onclick="toggleGroup('${group.id}')" style="border-left:4px solid ${group.color}">
      <span class="group-chevron">‚ñæ</span><span>${group.label}</span>
      <span style="margin-left:auto;font-size:10px;opacity:0.6">${gi.length}</span>
    </div>`;
    ba.innerHTML+=`<div class="group-bar-row" style="border-left:4px solid ${group.color};min-width:${totalW}px;background:${group.color}15"></div>`;

    gi.forEach(init=>{
      const pct=getPct(init);
      const rowClass=(isColl?'init-row hidden':'init-row')+(isCriticalPath(init)?' critical':'');
      const isExpanded=expanded[init.id];

      // Sidebar
      sb.innerHTML+=`<div class="${rowClass}" id="sb-${init.id}" style="border-left:3px solid ${init.color}">
        <div class="init-sidebar" onclick="toggleExpand('${init.id}')">
          <div style="display:flex;align-items:center;gap:6px;">
            <span style="font-size:9px;color:${init.color};transition:transform 0.2s;display:inline-block;transform:rotate(${isExpanded?90:0}deg)" id="chev-${init.id}">‚ñ∂</span>
            <div class="init-name">${init.name}</div>
          </div>
          <div class="init-lead" style="color:${init.color}">‚óè ${init.lead}</div>
          <div class="progress-wrap">
            <div class="progress-track"><div class="progress-fill" id="prog-${init.id}" style="width:${pct}%;background:${init.color}"></div></div>
            <span class="progress-pct" id="pct-${init.id}">${pct}%</span>
          </div>
          <div class="assignees">
            ${init.assignees.map(a=>`<span class="assignee-chip">${a}</span>`).join('')}
          </div>
        </div>
        <div class="activities-dropdown ${isExpanded?'open':''}" id="drop-${init.id}">
          ${renderDropdown(init)}
        </div>
      </div>`;

      // Bar row
      const bl=init.start*MW+4,bw=(init.end-init.start)*MW-8;
      const grid=MONTHS.map((_,i)=>`<div class="bar-grid-col ${i===TODAY_M?'today-col':''}"></div>`).join('');
      const msDiamonds=(init.milestones||[]).map(m=>{
        const ml=m.month*MW+(MW/2)-8;
        return `<div class="milestone-diamond" style="left:${ml}px;top:calc(50% - 8px);"><span class="ms-tooltip">${m.label}</span></div>`;
      }).join('');

      ba.innerHTML+=`<div class="${rowClass} bar-row" id="bar-${init.id}" data-group="${group.id}" style="min-width:${totalW}px">
        <div class="bar-grid">${grid}</div>
        <div class="gantt-bar ${isCriticalPath(init)?'critical-bar':''}" id="gbar-${init.id}"
          style="left:${bl}px;width:${bw}px;background:${init.color};"
          data-id="${init.id}" title="${init.name}">
          <div class="bar-progress-overlay" style="width:${100-pct}%;margin-left:${pct}%"></div>
          <div class="resize-handle left" data-id="${init.id}" data-side="left"></div>
          ${init.name.substring(0,24)}${init.name.length>24?'‚Ä¶':''}
          <div class="resize-handle right" data-id="${init.id}" data-side="right"></div>
        </div>
        ${msDiamonds}
      </div>
      <div class="init-row ${isColl?'hidden':''} ${isExpanded?'':'hidden'}" id="barexp-${init.id}" style="min-width:${totalW}px;background:var(--cream);height:4px;border-bottom:1px dashed var(--border)"></div>`;
    });
  });

  setTimeout(drawDeps,60);
  setupDragResize();
}

function renderDropdown(init){
  const pct=getPct(init);
  const activeActs=init.activities.filter(a=>!a.deprioritized);
  const deprActs=init.activities.filter(a=>a.deprioritized);
  return `<div class="act-dropdown-inner">
    <div class="act-section-title">Activities ‚Äî ${activeActs.filter(a=>a.done).length}/${activeActs.length} done ¬∑ ${pct}%</div>
    ${init.activities.map(a=>`
      <div class="act-item ${a.done?'done':''} ${a.deprioritized?'deprioritized':''}" id="act-${a.id}">
        <div class="act-check ${a.done?'checked':''} ${a.deprioritized?'deprioritized-check':''}"
          style="${a.deprioritized?'pointer-events:none;cursor:default;':''}"
          onclick="toggleAct('${init.id}','${a.id}',event)"></div>
        <div class="act-text">${a.text}</div>
        <div class="act-actions">
          ${a.milestone?`<span class="act-badge ms">Milestone</span>`:''}
          ${a.deprioritized
            ?`<span class="act-badge" style="background:#ece9e3;color:var(--muted)">Deprioritized</span>
              <button class="act-depr-btn reprioritize" onclick="toggleDeprioritize('${init.id}','${a.id}',event)" title="Restore to active">‚Üë Restore</button>`
            :`<button class="act-depr-btn" onclick="toggleDeprioritize('${init.id}','${a.id}',event)" title="Mark as deprioritized">‚Üì Depr.</button>`
          }
        </div>
      </div>`).join('')}
    ${init.deps&&init.deps.length?`<div style="margin-top:8px;padding:7px 10px;background:var(--rose-pale);border-radius:8px;font-size:11px;color:var(--rose);">
      üîó Depends on: ${init.deps.map(d=>{const di=initiatives.find(i=>i.id===d);return di?`<strong>${di.name}</strong>`:d;}).join(', ')}
    </div>`:''}
    <div class="assignee-editor-row">
      <span style="font-size:10px;font-weight:700;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-right:4px;">Assignees:</span>
      ${init.assignees.map(a=>`<span class="assignee-tag">${a}<span class="rm" onclick="removeAssignee('${init.id}','${a}',event)">√ó</span></span>`).join('')}
      <input class="add-input" id="ainput-${init.id}" placeholder="Add name‚Ä¶" onkeydown="if(event.key==='Enter'){addAssignee('${init.id}',event);}">
      <button class="add-btn-sm" onclick="addAssignee('${init.id}',event)">Add</button>
    </div>
    <div class="comments-section">
      <div class="act-section-title" style="margin-top:8px;">Comments (${init.comments.length})</div>
      <div id="cmts-${init.id}">
        ${init.comments.map(c=>`<div class="comment-item">
          <div class="comment-meta"><span class="comment-author">${escHtml(c.author)}</span><span>${escHtml(c.time)}</span></div>
          <div class="comment-text">${linkifyComment(escHtml(c.text))}</div>
        </div>`).join('')}
      </div>
      <div class="comment-input-row">
        <input class="comment-author-input" id="cauthor-${init.id}" placeholder="Your name">
        <div class="comment-input-wrap">
          <textarea class="comment-input" id="ctext-${init.id}" placeholder="Add a comment‚Ä¶ (max 200 chars, URLs auto-linked)" rows="2"
            oninput="onCommentInput('${init.id}',this)" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();addComment('${init.id}',event);}"></textarea>
          <span class="comment-char" id="cchar-${init.id}">0/200</span>
        </div>
        <button class="comment-submit" id="csub-${init.id}" onclick="addComment('${init.id}',event)">Post</button>
      </div>
    </div>
  </div>`;
}

// ‚îÄ‚îÄ INTERACTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleExpand(id){
  expanded[id]=!expanded[id];
  const drop=document.getElementById(`drop-${id}`);
  const chev=document.getElementById(`chev-${id}`);
  const barExp=document.getElementById(`barexp-${id}`);
  if(drop){drop.classList.toggle('open',expanded[id]);}
  if(chev){chev.style.transform=`rotate(${expanded[id]?90:0}deg)`;}
  if(barExp){barExp.classList.toggle('hidden',!expanded[id]);}
}

function toggleAct(initId,actId,e){
  e&&e.stopPropagation();
  const init=initiatives.find(i=>i.id===initId);
  const act=init.activities.find(a=>a.id===actId);
  if(act.deprioritized)return;
  act.done=!act.done;
  const el=document.getElementById(`act-${actId}`);
  if(el){
    el.classList.toggle('done',act.done);
    el.querySelector('.act-check').classList.toggle('checked',act.done);
  }
  const pct=getPct(init);
  const titleEl=document.querySelector(`#drop-${initId} .act-section-title`);
  const activeActs=init.activities.filter(a=>!a.deprioritized);
  if(titleEl) titleEl.textContent=`Activities ‚Äî ${activeActs.filter(a=>a.done).length}/${activeActs.length} done ¬∑ ${pct}%`;
  updateProgressBar(init);
  saveState();
}

function toggleDeprioritize(initId,actId,e){
  e&&e.stopPropagation();
  const init=initiatives.find(i=>i.id===initId);
  const act=init.activities.find(a=>a.id===actId);
  act.deprioritized=!act.deprioritized;
  if(act.deprioritized) act.done=false;
  refreshDropdown(initId);
  updateProgressBar(init);
  saveState();
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function escHtml(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function linkifyComment(s){
  return s.replace(/(https?:\/\/[^\s<>"]+)/g,'<a href="$1" target="_blank" rel="noopener">$1</a>');
}
function onCommentInput(initId,ta){
  const max=200;
  const len=ta.value.length;
  if(len>max) ta.value=ta.value.substring(0,max);
  const charEl=document.getElementById(`cchar-${initId}`);
  const subEl=document.getElementById(`csub-${initId}`);
  const cur=Math.min(len,max);
  if(charEl){
    charEl.textContent=`${cur}/200`;
    charEl.className='comment-char'+(cur>=200?' over':cur>=160?' warn':'');
  }
  if(subEl) subEl.disabled=cur===0;
  // auto-expand
  ta.style.height='auto';
  ta.style.height=Math.min(ta.scrollHeight,120)+'px';
}

function updateProgressBar(init){
  const pct=getPct(init);
  const fill=document.getElementById(`prog-${init.id}`);
  const pctEl=document.getElementById(`pct-${init.id}`);
  if(fill){fill.style.width=pct+'%';}
  if(pctEl){pctEl.textContent=pct+'%';}
  // Update bar overlay
  const overlay=document.querySelector(`#gbar-${init.id} .bar-progress-overlay`);
  if(overlay){overlay.style.width=(100-pct)+'%';overlay.style.marginLeft=pct+'%';}
  updateOverall();
}

function addAssignee(initId,e){
  e&&e.stopPropagation();
  const input=document.getElementById(`ainput-${initId}`);
  const name=input?.value?.trim();
  if(!name)return;
  const init=initiatives.find(i=>i.id===initId);
  if(!init.assignees.includes(name)){init.assignees.push(name);}
  input.value='';
  refreshDropdown(initId);
  refreshSidebarAssignees(initId);
  saveState();
}

function removeAssignee(initId,name,e){
  e&&e.stopPropagation();
  const init=initiatives.find(i=>i.id===initId);
  init.assignees=init.assignees.filter(a=>a!==name);
  refreshDropdown(initId);
  refreshSidebarAssignees(initId);
  saveState();
}

function addComment(initId,e){
  e&&e.stopPropagation();
  const author=document.getElementById(`cauthor-${initId}`)?.value?.trim()||'Team';
  const rawText=document.getElementById(`ctext-${initId}`)?.value?.trim();
  if(!rawText)return;
  const text=rawText.substring(0,200);
  const init=initiatives.find(i=>i.id===initId);
  const now=new Date();
  init.comments.push({author,text,time:now.toLocaleDateString('en-US',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})});
  document.getElementById(`ctext-${initId}`).value='';
  const charEl=document.getElementById(`cchar-${initId}`);
  if(charEl){charEl.textContent='0/200';charEl.className='comment-char';}
  const ta=document.getElementById(`ctext-${initId}`);
  if(ta){ta.style.height='auto';}
  const cmtEl=document.getElementById(`cmts-${initId}`);
  if(cmtEl) cmtEl.innerHTML=init.comments.map(c=>`<div class="comment-item">
    <div class="comment-meta"><span class="comment-author">${escHtml(c.author)}</span><span>${escHtml(c.time)}</span></div>
    <div class="comment-text">${linkifyComment(escHtml(c.text))}</div>
  </div>`).join('');
  const commentTitle=document.querySelector(`#drop-${initId} .comments-section .act-section-title`);
  if(commentTitle) commentTitle.textContent=`Comments (${init.comments.length})`;
  saveState();
}

function refreshDropdown(initId){
  const init=initiatives.find(i=>i.id===initId);
  const drop=document.getElementById(`drop-${initId}`);
  if(!drop)return;
  const wasOpen=drop.classList.contains('open');
  drop.innerHTML=renderDropdown(init);
  if(wasOpen)drop.classList.add('open');
}

function refreshSidebarAssignees(initId){
  const init=initiatives.find(i=>i.id===initId);
  const assigneesEl=document.querySelector(`#sb-${initId} .assignees`);
  if(assigneesEl) assigneesEl.innerHTML=init.assignees.map(a=>`<span class="assignee-chip">${a}</span>`).join('');
}

function toggleGroup(id){
  collapsed[id]=!collapsed[id];
  render();
}

function filterTeam(team,btn){
  activeFilter=team;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  render();
}

function toggleCritical(cb){
  showCritical=cb.checked;
  document.getElementById('criticalToggle').classList.toggle('active',showCritical);
  render();
}

function switchView(view,btn){
  document.querySelectorAll('.view-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  const gantt=document.getElementById('viewGantt');
  const wl=document.getElementById('viewWorkload');
  if(view==='gantt'){gantt.classList.add('active');gantt.classList.remove('hidden');wl.classList.remove('active');wl.classList.add('hidden');}
  else{wl.classList.add('active');wl.classList.remove('hidden');gantt.classList.remove('active');gantt.classList.add('hidden');renderWorkload();}
}

// ‚îÄ‚îÄ WORKLOAD VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderWorkload(){
  const el=document.getElementById('viewWorkload');
  const personMap={};
  initiatives.filter(matchesFilter).forEach(init=>{
    init.assignees.forEach(person=>{
      if(!personMap[person])personMap[person]={name:person,initiatives:[],monthLoad:Array(12).fill(0)};
      personMap[person].initiatives.push(init);
      for(let m=init.start;m<init.end;m++) personMap[person].monthLoad[m]++;
    });
  });
  const people=Object.values(personMap);
  if(!people.length){el.innerHTML=`<p style="color:var(--muted);padding:40px;">No assignees found. Add assignees to initiatives to see workload.</p>`;return;}
  const maxLoad=Math.max(...people.flatMap(p=>p.monthLoad),1);
  el.innerHTML=`<div class="wl-title">Workload by Person</div>
    <div class="wl-sub">Monthly initiative load per assignee ¬∑ ${people.length} people across ${initiatives.filter(matchesFilter).length} initiatives</div>
    ${people.map(p=>{
      const initials=p.name.split('/').map(n=>n.trim()[0]).join('').substring(0,2).toUpperCase();
      const avatar_color=['#4A9B8E','#C8903A','#C97B6A','#7A9E7E','#8A7A9E'][p.name.charCodeAt(0)%5];
      return`<div class="wl-person">
        <div class="wl-person-header">
          <div class="wl-avatar" style="background:${avatar_color}">${initials}</div>
          <div><div class="wl-name">${p.name}</div><div class="wl-count">${p.initiatives.length} initiative${p.initiatives.length!==1?'s':''}</div></div>
          <div style="margin-left:auto;display:flex;gap:4px;flex-wrap:wrap;max-width:340px;">
            ${p.initiatives.map(i=>`<span class="wl-initiative-tag" style="background:${i.color}">${i.name.substring(0,20)}${i.name.length>20?'‚Ä¶':''}</span>`).join('')}
          </div>
        </div>
        <div class="wl-months">
          ${MONTHS.map((m,idx)=>{
            const load=p.monthLoad[idx];
            const h=load?Math.max(8,Math.round(load/maxLoad*60)):4;
            const col=load===0?'var(--cream-dark)':load>=3?'var(--critical)':load===2?'var(--gold)':'var(--teal)';
            return`<div class="wl-month-col">
              <div class="wl-month-label">${m}</div>
              <div style="display:flex;flex-direction:column;justify-content:flex-end;height:64px;">
                <div class="wl-month-bar" style="height:${h}px;background:${col}"></div>
              </div>
              <div class="wl-month-num" style="color:${load>=3?'var(--critical)':load===2?'var(--gold)':'var(--muted)'}">${load||''}</div>
            </div>`;
          }).join('')}
        </div>
      </div>`;
    }).join('')}`;
}

// ‚îÄ‚îÄ DEPENDENCY ARROWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function drawDeps(){
  document.querySelectorAll('.dep-svg').forEach(s=>s.remove());
  const ba=document.getElementById('barsArea');
  const svg=document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.classList.add('dep-svg');
  svg.style.cssText='position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;overflow:visible;';
  const areaRect=ba.getBoundingClientRect();
  initiatives.filter(matchesFilter).forEach(init=>{
    if(!init.deps||!init.deps.length)return;
    const toRow=document.getElementById(`bar-${init.id}`);
    if(!toRow||toRow.classList.contains('hidden'))return;
    init.deps.forEach(depId=>{
      const fromRow=document.getElementById(`bar-${depId}`);
      if(!fromRow||fromRow.classList.contains('hidden'))return;
      const fromInit=initiatives.find(i=>i.id===depId);
      if(!fromInit)return;
      const fromRect=fromRow.getBoundingClientRect();
      const toRect=toRow.getBoundingClientRect();
      const isCrit=showCritical&&init.critical&&fromInit.critical;
      const x1=fromInit.end*MW-4,y1=fromRect.top-areaRect.top+fromRect.height/2;
      const x2=init.start*MW+4,y2=toRect.top-areaRect.top+toRect.height/2;
      const cx=(x1+x2)/2;
      const path=document.createElementNS('http://www.w3.org/2000/svg','path');
      path.setAttribute('class',`dep-arrow${isCrit?' critical-dep':''}`);
      path.setAttribute('d',`M${x1} ${y1} C${cx} ${y1},${cx} ${y2},${x2} ${y2}`);
      const arrow=document.createElementNS('http://www.w3.org/2000/svg','polygon');
      arrow.setAttribute('class',`dep-head${isCrit?' critical-dep':''}`);
      arrow.setAttribute('points',`${x2},${y2} ${x2-7},${y2-4} ${x2-7},${y2+4}`);
      svg.appendChild(path);svg.appendChild(arrow);
    });
  });
  ba.appendChild(svg);
}

// ‚îÄ‚îÄ DRAG & RESIZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let msDragState=null;

function setupDragResize(){
  document.querySelectorAll('.gantt-bar').forEach(bar=>{
    bar.addEventListener('mousedown',onBarMousedown);
  });
  document.querySelectorAll('.resize-handle').forEach(h=>{
    h.addEventListener('mousedown',onResizeMousedown);
  });
  document.querySelectorAll('.milestone-diamond').forEach(d=>{
    d.addEventListener('mousedown',onMilestoneMousedown);
  });
}

function onMilestoneMousedown(e){
  e.preventDefault();e.stopPropagation();
  const el=e.currentTarget;
  const initId=el.closest('.bar-row')?.dataset?.id||el.closest('[id^="bar-"]')?.id?.replace('bar-','');
  // find initId from sibling bar
  const barRow=el.parentElement;
  const barEl=barRow.querySelector('.gantt-bar');
  if(!barEl)return;
  const iid=barEl.dataset.id;
  const init=initiatives.find(i=>i.id===iid);
  if(!init)return;
  // which milestone? find by current left position
  const curLeft=parseInt(el.style.left);
  const msIdx=init.milestones.findIndex(m=>{
    const ml=m.month*MW+(MW/2)-8;
    return Math.abs(ml-curLeft)<MW/2;
  });
  if(msIdx<0)return;
  el.style.cursor='grabbing';
  el.style.zIndex='30';
  msDragState={init,el,msIdx,startX:e.clientX,origMonth:init.milestones[msIdx].month};
  document.addEventListener('mousemove',onMilestoneDragMove);
  document.addEventListener('mouseup',onMilestoneDragUp);
}

function onMilestoneDragMove(e){
  if(!msDragState)return;
  const dx=e.clientX-msDragState.startX;
  const md=Math.round(dx/MW);
  let nm=Math.max(0,Math.min(11,msDragState.origMonth+md));
  msDragState.init.milestones[msDragState.msIdx].month=nm;
  const newLeft=nm*MW+(MW/2)-8;
  msDragState.el.style.left=newLeft+'px';
  // Update tooltip
  const tip=msDragState.el.querySelector('.ms-tooltip');
  if(tip){
    const parts=msDragState.init.milestones[msDragState.msIdx].label.replace(/^[A-Za-z]+:/,'').trim();
    tip.textContent=`${MONTHS[nm]}: ${parts}`;
    msDragState.init.milestones[msDragState.msIdx].label=`${MONTHS[nm]}: ${parts}`;
  }
}

function onMilestoneDragUp(){
  if(msDragState){
    msDragState.el.style.cursor='pointer';
    msDragState.el.style.zIndex='10';
    msDragState=null;
    saveState();
  }
  document.removeEventListener('mousemove',onMilestoneDragMove);
  document.removeEventListener('mouseup',onMilestoneDragUp);
}

function onBarMousedown(e){
  if(e.target.classList.contains('resize-handle'))return;
  e.preventDefault();
  const initId=e.currentTarget.dataset.id;
  const init=initiatives.find(i=>i.id===initId);
  if(!init)return;
  const bar=e.currentTarget;
  const startX=e.clientX;
  const origStart=init.start,origEnd=init.end;
  bar.classList.add('dragging');
  dragState={init,bar,startX,origStart,origEnd};
  document.addEventListener('mousemove',onDragMove);
  document.addEventListener('mouseup',onDragUp);
}

function onDragMove(e){
  if(!dragState)return;
  const dx=e.clientX-dragState.startX;
  const monthDelta=Math.round(dx/MW);
  let ns=dragState.origStart+monthDelta;
  let ne=dragState.origEnd+monthDelta;
  if(ns<0){ne-=ns;ns=0;}
  if(ne>12){ns-=(ne-12);ne=12;}
  ns=Math.max(0,ns);ne=Math.min(12,ne);
  if(ne<=ns)return;
  dragState.init.start=ns;dragState.init.end=ne;
  const bl=ns*MW+4,bw=(ne-ns)*MW-8;
  dragState.bar.style.left=bl+'px';dragState.bar.style.width=bw+'px';
}

function onDragUp(){
  if(dragState){dragState.bar.classList.remove('dragging');dragState=null;saveState();drawDeps();}
  document.removeEventListener('mousemove',onDragMove);
  document.removeEventListener('mouseup',onDragUp);
}

function onResizeMousedown(e){
  e.preventDefault();e.stopPropagation();
  const initId=e.currentTarget.dataset.id;
  const side=e.currentTarget.dataset.side;
  const init=initiatives.find(i=>i.id===initId);
  const bar=document.getElementById(`gbar-${initId}`);
  if(!init||!bar)return;
  resizeState={init,bar,side,startX:e.clientX,origStart:init.start,origEnd:init.end};
  document.addEventListener('mousemove',onResizeMove);
  document.addEventListener('mouseup',onResizeUp);
}

function onResizeMove(e){
  if(!resizeState)return;
  const dx=e.clientX-resizeState.startX;
  const md=Math.round(dx/MW);
  if(resizeState.side==='right'){
    const ne=Math.max(resizeState.origStart+1,Math.min(12,resizeState.origEnd+md));
    resizeState.init.end=ne;
  }else{
    const ns=Math.min(resizeState.origEnd-1,Math.max(0,resizeState.origStart+md));
    resizeState.init.start=ns;
  }
  const {start,end}=resizeState.init;
  resizeState.bar.style.left=(start*MW+4)+'px';
  resizeState.bar.style.width=((end-start)*MW-8)+'px';
}

function onResizeUp(){
  if(resizeState){resizeState=null;saveState();drawDeps();}
  document.removeEventListener('mousemove',onResizeMove);
  document.removeEventListener('mouseup',onResizeUp);
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadState();
render();
</script>
</body>
</html>
